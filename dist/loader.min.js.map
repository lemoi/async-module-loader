{"version":3,"sources":["loader.js"],"names":["undefined","Loader","Error","fetchTextFromURL","url","callback","error","xhr","status","statusText","XMLHttpRequest","onerror","onreadystatechange","readyState","responseText","open","setRequestHeader","send","loadScript","path","parent","Modules","hasAdd","_module","Module","set","script_text","script","Script","children","deP","length","setTimeout","init","register","exports","i","load","this","getDep","wrapStart","execPart","wrapEnd","prototype","generate","Head","window","document","head","body","createElement","text","appendChild","removeChild","regExp","result","exec","push","Path","polyfill","loaded","id","require","get","IdManager","getId","__M","module","setId","hasLoaded","deps","encode","fnObj","idList","waitFor","join","__fnQueue","Array","waitfor","finished","syncExec","queue","key","j","con","checkOut","index","indexOf","splice","path_id_map","_id","rtObj","getModule","setEntry"],"mappings":"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","file":"loader.min.js","sourcesContent":["/*\r\nAPI:\r\n    Loader.setEntry('main.js');加载入口\r\n\t\t1.加载脚本文件\r\n\t\t2.判断其依赖关系 找出没有加载完成的模块\r\n\t\t3.加载未加载的模块，判断依赖关系\r\n*/\r\n\r\n/* the loaderjs is just used for browser*/\r\nif(Loader!==undefined) throw new Error('the loader namespace may be used for other lib');\r\nvar Loader=(function(){\r\n\t/*\r\n\t\tajax加载文件\r\n\t\t@param {string} url fetch的地址\r\n\t\t@param {function} callback 用来执行加载完成的操作  \r\n\t*/\r\n\tvar fetchTextFromURL=function(url,callback){\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onerror = error;\r\n    function error() {\r\n   \t\tthrow new Error('XHR error' + (xhr.status ? ' (' + xhr.status + (xhr.statusText ? ' ' + xhr.statusText  : '') + ')' : '') + ' loading ' + url);\r\n    }\r\n    xhr.onreadystatechange = function () {\r\n      if (xhr.readyState === 4) {\r\n        if (xhr.status === 200) {\r\n          callback(xhr.responseText);\r\n        }else {\r\n          error();\r\n        }\r\n      }\r\n    };\r\n    xhr.open(\"GET\", url, true);\r\n    if (xhr.setRequestHeader) {\r\n      xhr.setRequestHeader('Accept', 'application/x-es-module, */*');\r\n    }\r\n    xhr.send();\r\n\t};\r\n\tvar loadScript=function(path,parent,callback){\r\n\t\t\tif(Modules.hasAdd(path)) return;\r\n\t\t\tvar _module=new Module(path,parent);\r\n\t\t\tModules.set(path,_module);\r\n\t\t\tfetchTextFromURL(path,function(script_text){\r\n\t\t\t\tvar script=new Script(script_text,path);\r\n\t\t\t\t_module.children=script.deP;\r\n\t\t\t\tif(_module.children.length===0){\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tscript.init();\r\n\t\t\t\t\t\tif(callback!==undefined) setTimeout(callback,0);\r\n\t\t\t\t\t},0);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tModules.register(_module.children,function(){\r\n\t\t\t\t\t\tscript.init();\r\n\t\t\t\t\t\tif(callback!==undefined) setTimeout(function(){\r\n\t\t\t\t\t\t\tcallback(_module.exports);\r\n\t\t\t\t\t\t},0);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tfor(var i in _module.children){\r\n\t\t\t\t\t\tvar load=loadScript(_module.children[i],path);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\tvar Script=function(script_text,path){\r\n\t\tthis.deP=Script.getDep(script_text);\r\n\t\tthis.wrapStart='(function(){var module=Loader.getModule(\\''+path+'\\');(function(require,exports){';\r\n\t\tthis.execPart=script_text;\r\n\t\tthis.wrapEnd='})(module.require,module.exports);module.loaded=true;Loader.checkOut(\\''+path+'\\')})()';\r\n\t};\r\n\tScript.prototype.generate=function(){\r\n\t\treturn this.wrapStart+this.execPart+this.wrapEnd;\r\n\t};\r\n\tScript.prototype.init=function(){\r\n\t\tvar Head=window.document.head||window.document.body;\r\n\t\tvar script=document.createElement('script');\r\n\t\tscript.text=this.generate();\r\n\t\tHead.appendChild(script);\r\n\t\tHead.removeChild(script);\r\n\t};\r\n\tScript.regExp=/require\\(([\"'])(.*?)\\1\\)/g;\r\n\tScript.getDep=function(script_text){\r\n\t\tvar result,deP=[];\r\n\t\twhile((result=Script.regExp.exec(script_text))!==null){\r\n\t\t\tdeP.push(Path.polyfill(result[2]));\r\n\t\t}\r\n\t\treturn deP;\r\n\t};\r\n\tvar Path=function(){};\r\n\tPath.regExp=/^(\\.{1,2})?(\\/)?.*?\\.js/;\r\n\tPath.polyfill=function(path){\r\n\t\tvar result=Path.regExp.exec(path);\r\n\t\tif (result===null){\r\n\t\t\treturn './'+path+'.js';\r\n\t\t}else if(result[2]===undefined){\r\n\t\t\treturn \"./\"+path;\r\n\t\t}else if(result[1]===undefined){\r\n\t\t\treturn \".\"+path;\r\n\t\t}\r\n\t\treturn path;\r\n\t};\r\n\tvar Module=function(path,parent){\r\n\t\tthis.exports={};\r\n\t\tthis.loaded=false;\r\n\t\tthis.id=path;\r\n\t\tthis.parent=parent;//' LOADER'为入口\r\n\t\tthis.children=null;\r\n\t};\r\n\tModule.prototype.require=function(path){\r\n\t\treturn Modules.get(Path.polyfill(path)).exports;\r\n\t};\r\n\tvar Modules=(function(){\r\n\t\tvar __M=[],path_id_map={},__fnQueue={};\r\n\t\tvar IdManager=function(){};\r\n\t\tIdManager._id=1;\r\n\t\tIdManager.setId=function(path){\r\n\t\t\tvar id=path_id_map[path];\r\n\t\t\tif(id===undefined){\r\n\t\t\t\tpath_id_map[path]=this._id;\r\n\t\t\t\treturn this._id++;\r\n\t\t\t}else{\r\n\t\t\t\treturn id;\r\n\t\t\t}\r\n\t\t};\r\n\t\tIdManager.getId=function(path){\r\n\t\t\treturn path_id_map[path];\r\n\t\t};\r\n\t\tfunction hasAdd(path){\r\n\t\t\tvar id;\r\n\t\t\treturn !!((id=IdManager.getId(path))&&(__M[id]));\r\n\t\t}\r\n\t\tfunction set(path,module){\r\n\t\t\tvar id=IdManager.setId(path);\r\n\t\t\t__M[id]=module;\r\n\t\t}\r\n\t\tfunction get(path){\r\n\t\t\tvar id,module;\r\n\t\t\tif(!((id=IdManager.getId(path))&&(module=__M[id]))){\r\n\t\t\t\tthrow new Error(\"can't get the module\");\r\n\t\t\t}\r\n\t\t\treturn module;\r\n\t\t}\r\n\t\tfunction hasLoaded(path){\r\n\t\t\tvar id;\r\n\t\t\treturn !!((id=IdManager.getId(path))&&__M[id]&&__M[id].loaded);\r\n\t\t}\r\n\t\tfunction register(deps,callback){\r\n\t\t\tvar i,id,idList=[],encode,waitFor=[],fnObj;\r\n\t\t\tfor(i=0;i<deps.length;i++){\t\r\n\t\t\t\tid=IdManager.setId(deps[i]);\r\n\t\t\t\tidList.push(id);\r\n\t\t\t\tif(!hasLoaded(deps[i])) waitFor.push(id);\r\n\t\t\t}\r\n\t\t\tencode=idList.join('&');\r\n\t\t\tif(__fnQueue[encode]!==undefined)\r\n\t\t\t\tif(typeof __fnQueue[encode].exec === 'function'){\r\n\t\t\t\t\t__fnQueue[encode].exec=Array(__fnQueue[encode].exec).push(callback);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t__fnQueue[encode].exec.push(callback);\r\n\t\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t__fnQueue[encode]={};\r\n\t\t\t\tfnObj=__fnQueue[encode];\r\n\t\t\t\tfnObj.exec=callback;\r\n\t\t\t\tfnObj.waitfor=waitFor;\r\n\t\t\t\tfnObj.finished=false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction syncExec(queue,key){\r\n\t\t\tif(typeof queue[key].exec ==='function'){\r\n\t\t\t\tqueue[key].finished=true;\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tqueue[key].exec();\r\n\t\t\t\t\tdelete queue[key];\r\n\t\t\t\t},0);\r\n\t\t\t}else{\r\n\t\t\t\tfor(var j in queue[key].exec){\r\n\t\t\t\t\tqueue[key].finished=true;\r\n\t\t\t\t\t(function(){\r\n\t\t\t\t\t\tvar con=j,i=0;\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\tqueue[key].exec[con]();\r\n\t\t\t\t\t\t\tif(i===j) delete queue[key];\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t},0);\r\n\t\t\t\t\t})();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction checkOut(path){\r\n\t\t\tvar i,waitFor,id;\r\n\t\t\tid=IdManager.getId(path);\r\n\t\t\tif(id===undefined){\r\n\t\t\t\tthrow new Error('the path is not included');\r\n\t\t\t}\r\n\t\t\tfor(i in __fnQueue){\r\n\t\t\t\tif(__fnQueue[i].finished) continue;\r\n\t\t\t\twaitFor=__fnQueue[i].waitfor;\r\n\t\t\t\tindex=waitFor.indexOf(id);\r\n\t\t\t\tif(index===undefined)  continue;\r\n\t\t\t\twaitFor.splice(index,1);\r\n\t\t\t\tif(waitFor.length===0){\r\n\t\t\t\t\tsyncExec(__fnQueue,i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tset:set,\r\n\t\t\tget:get,\r\n\t\t\tregister:register,\r\n\t\t\tcheckOut:checkOut,\r\n\t\t\thasAdd:hasAdd\r\n\t\t};\r\n\t})();\r\n\tvar rtObj={};\r\n\t//不暴露设置不可遍历\r\n\trtObj.getModule=Modules.get;\r\n\t//入口\r\n\trtObj.setEntry=function(path,callback){\r\n\t\tpath=Path.polyfill(path);\r\n\t\tvar load=loadScript(path,'LOADER',callback);\r\n\t};\r\n\trtObj.checkOut=Modules.checkOut;\r\n\t// Obejct.defineProperties(rtObj,{\r\n\t// \tmodule:{\r\n\t// \t\tvalue:module\r\n\t// \t},\r\n\t// \tentry:{\r\n\t// \t\tset:function(){\r\n\r\n\t// \t\t}\r\n\t// \t}\r\n\t// });\r\n\treturn rtObj;\r\n})();\r\n/*\r\nfunction(){\r\n\tmodule=new Module();\r\n\tfunction(exports,require){\r\n\t\t\r\n\t}(module.exports,module.require)\t\r\n}();\r\n\r\n*/"],"sourceRoot":"/source/"}