{"version":3,"sources":["loader.js"],"names":["undefined","Loader","Error","deepCopy","obj","copyObj","o","target","i","copyFunc","func","temp","apply","this","arguments","key","obj_copy","type","fetchTextFromURL","url","callback","error","xhr","status","statusText","XMLHttpRequest","onerror","onreadystatechange","readyState","responseText","open","setRequestHeader","send","loadScript","path","parent","Modules","hasAdd","_module","Module","set","script_text","script","Script","children","deP","length","setTimeout","init","register","exports","load","getDep","wrapStart","execPart","wrapEnd","prototype","generate","Head","window","document","head","body","createElement","text","appendChild","removeChild","regExp","result","exec","push","Path","polyfill","loaded","id","require","get","IdManager","getId","__M","module","setId","hasLoaded","deps","encode","fnObj","idList","waitFor","join","__fnQueue","waitfor","finished","asyncExec","queue","j","con","checkOut","index","indexOf","splice","path_id_map","_id","rtObj","getModule","setEntry"],"mappings":"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","file":"loader.min.js","sourcesContent":["/*\r\nAPI:\r\n    Loader.setEntry('main.js');加载入口\r\n\t\t1.加载脚本文件\r\n\t\t2.判断其依赖关系 找出没有加载完成的模块\r\n\t\t3.加载未加载的模块，判断依赖关系\r\n\t\t需要解决的问题 循环引用\r\n*/\r\n\r\n/* the loaderjs is just used for browser*/\r\nif(Loader!==undefined) throw new Error('the loader namespace may be used for other lib');\r\nvar Loader=(function(){\r\n\t\tvar deepCopy=function(obj){\r\n\t\t\tvar obj_copy,type=typeof obj;\r\n\t\t\tfunction copyObj(o,target){\r\n\t\t\t\tfor(var i in o){ \t\r\n\t\t\t\t\tif(typeof o[i]==='object'&&o[i]!==null){\r\n\t\t\t\t\t\ttarget[i]={};\r\n\t\t\t\t\t\tcopyObj(o[i],target[i]);\t\r\n\t\t\t\t\t}else if(typeof o[i]==='function'){\r\n\t\t\t\t\t\ttarget[i]=copyFunc(o[i]);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttarget[i]=o[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfunction copyFunc(func){\r\n\t\t\t\tvar temp=function(){\r\n\t\t\t\t\treturn func.apply(this,arguments);\r\n\t\t\t\t};\r\n\t\t\t\tfor(var key in func){\r\n\t\t\t\t\ttemp[key]=deepCopy(func[key]);\r\n\t\t\t\t}\r\n\t\t\t\treturn temp;\r\n\t\t\t}\r\n\t\t\tif(type==='function'){\r\n\t\t\t\tobj_copy=copyFunc(obj);\r\n\t\t\t}else if(type==='object'&&obj!==null){\r\n\t\t\t\tobj_copy={};\r\n\t\t\t\tcopyObj(obj,obj_copy);\r\n\t\t\t}else{\r\n\t\t\t\tobj_copy=obj;\r\n\t\t\t}\r\n\t\t\treturn obj_copy;\r\n\t\t};\r\n\t\t/*\r\n\t\t\tajax加载文件\r\n\t\t\t@param {string} url fetch的地址\r\n\t\t\t@param {function} callback 用来执行加载完成的操作  \r\n\t\t*/\r\n  \tvar fetchTextFromURL=function(url,callback){\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onerror = error;\r\n    function error() {\r\n   \t\tthrow new Error('XHR error' + (xhr.status ? ' (' + xhr.status + (xhr.statusText ? ' ' + xhr.statusText  : '') + ')' : '') + ' loading ' + url);\r\n    }\r\n    xhr.onreadystatechange = function () {\r\n\t\tif (xhr.readyState === 4) {\r\n\t\tif (xhr.status === 200) {\r\n\t\t  callback(xhr.responseText);\r\n\t\t}else {\r\n\t\t  error();\r\n\t\t}\r\n\t\t}\r\n    };\r\n    xhr.open(\"GET\", url, true);\r\n    if (xhr.setRequestHeader) {\r\n      xhr.setRequestHeader('Accept', 'application/x-es-module, */*');\r\n    }\r\n    xhr.send();\r\n\t};\r\n\tvar loadScript=function(path,parent,callback){\r\n\t\tif(Modules.hasAdd(path)) return;\r\n\t\tvar _module=new Module(path,parent);\r\n\t\tModules.set(path,_module);\r\n\t\tfetchTextFromURL(path,function(script_text){\r\n\t\t\tvar script=new Script(script_text,path);\r\n\t\t\t_module.children=script.deP;\r\n\t\t\tif(_module.children.length===0){\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tscript.init();\r\n\t\t\t\t\tif(callback!==undefined) setTimeout(callback,0);\r\n\t\t\t\t},0);\r\n\t\t\t}else{\r\n\t\t\t\tModules.register(_module.children,function(){\r\n\t\t\t\t\tscript.init();\r\n\t\t\t\t\tif(callback!==undefined) setTimeout(function(){\r\n\t\t\t\t\t\tcallback(_module.exports);\r\n\t\t\t\t\t},0);\r\n\t\t\t\t});\r\n\t\t\t\tfor(var i in _module.children){\r\n\t\t\t\t\tvar load=loadScript(_module.children[i],path);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tvar Script=function(script_text,path){\r\n\t\tthis.deP=Script.getDep(script_text);\r\n\t\tthis.wrapStart='(function(){var module=Loader.getModule(\\''+path+'\\');(function(require,exports){';\r\n\t\tthis.execPart=script_text;\r\n\t\tthis.wrapEnd='})(module.require,module.exports);module.loaded=true;Loader.checkOut(\\''+path+'\\')})()';\r\n\t};\r\n\tScript.prototype.generate=function(){\r\n\t\treturn this.wrapStart+this.execPart+this.wrapEnd;\r\n\t};\r\n\tScript.prototype.init=function(){\r\n\t\tvar Head=window.document.head||window.document.body;\r\n\t\tvar script=document.createElement('script');\r\n\t\tscript.text=this.generate();\r\n\t\tHead.appendChild(script);\r\n\t\tHead.removeChild(script);\r\n\t};\r\n\tScript.regExp=/require\\(([\"'])(.*?)\\1\\)/g;\r\n\tScript.getDep=function(script_text){\r\n\t\tvar result,deP=[];\r\n\t\twhile((result=Script.regExp.exec(script_text))!==null){\r\n\t\t\tdeP.push(Path.polyfill(result[2]));\r\n\t\t}\r\n\t\treturn deP;\r\n\t};\r\n\tvar Path=function(){};\r\n\tPath.regExp=/^(\\.{1,2})?(\\/)?.*?\\.js/;\r\n\tPath.polyfill=function(path){\r\n\t\tvar result=Path.regExp.exec(path);\r\n\t\tif (result===null){\r\n\t\t\treturn './'+path+'.js';\r\n\t\t}else if(result[2]===undefined){\r\n\t\t\treturn \"./\"+path;\r\n\t\t}else if(result[1]===undefined){\r\n\t\t\treturn \".\"+path;\r\n\t\t}\r\n\t\treturn path;\r\n\t};\r\n\r\n\tvar Module=function(path,parent){\r\n\t\tthis.exports={};\r\n\t\tthis.loaded=false;\r\n\t\tthis.id=path;\r\n\t\tthis.parent=parent;//' LOADER'为入口\r\n\t\tthis.children=null;\r\n\t};\r\n\tModule.prototype.require=function(path){\r\n\t\treturn deepCopy(Modules.get(Path.polyfill(path)).exports);\r\n\t};\r\n\tvar Modules=(function(){\r\n\t\tvar __M=[],path_id_map={},__fnQueue={};\r\n\t\tvar IdManager=function(){};\r\n\t\tIdManager._id=1;\r\n\t\tIdManager.setId=function(path){\r\n\t\t\tvar id=path_id_map[path];\r\n\t\t\tif(id===undefined){\r\n\t\t\t\tpath_id_map[path]=this._id;\r\n\t\t\t\treturn this._id++;\r\n\t\t\t}else{\r\n\t\t\t\treturn id;\r\n\t\t\t}\r\n\t\t};\r\n\t\tIdManager.getId=function(path){\r\n\t\t\treturn path_id_map[path];\r\n\t\t};\r\n\t\tfunction hasAdd(path){\r\n\t\t\tvar id;\r\n\t\t\treturn !!((id=IdManager.getId(path))&&(__M[id]));\r\n\t\t}\r\n\t\tfunction set(path,module){\r\n\t\t\tvar id=IdManager.setId(path);\r\n\t\t\t__M[id]=module;\r\n\t\t}\r\n\t\tfunction get(path){\r\n\t\t\tvar id,module;\r\n\t\t\tif(!((id=IdManager.getId(path))&&(module=__M[id]))){\r\n\t\t\t\tthrow new Error(\"can't get the module\");\r\n\t\t\t}\r\n\t\t\treturn module;\r\n\t\t}\r\n\t\tfunction hasLoaded(path){\r\n\t\t\tvar id;\r\n\t\t\treturn !!((id=IdManager.getId(path))&&__M[id]&&__M[id].loaded);\r\n\t\t}\r\n\t\tfunction register(deps,callback){\r\n\t\t\tvar i,id,idList=[],encode,waitFor=[],fnObj,temp;\r\n\t\t\tfor(i=0;i<deps.length;i++){\t\r\n\t\t\t\tid=IdManager.setId(deps[i]);\r\n\t\t\t\tidList.push(id);\r\n\t\t\t\tif(!hasLoaded(deps[i])) waitFor.push(id);\r\n\t\t\t}\r\n\t\t\tencode=idList.join('&');\r\n\t\t\tif(__fnQueue[encode]!==undefined)\r\n\t\t\t\tif(typeof __fnQueue[encode].exec === 'function'){\r\n\t\t\t\t\ttemp=__fnQueue[encode].exec;\r\n\t\t\t\t\t__fnQueue[encode].exec=[];\r\n\t\t\t\t\t__fnQueue[encode].exec.push(temp,callback);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t__fnQueue[encode].exec.push(callback);\r\n\t\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t__fnQueue[encode]={};\r\n\t\t\t\tfnObj=__fnQueue[encode];\r\n\t\t\t\tfnObj.exec=callback;\r\n\t\t\t\tfnObj.waitfor=waitFor;\r\n\t\t\t\tfnObj.finished=false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction asyncExec(queue,key){\r\n\t\t\tif(typeof queue[key].exec ==='function'){\r\n\t\t\t\tqueue[key].finished=true;\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tqueue[key].exec();\r\n\t\t\t\t\tdelete queue[key];\r\n\t\t\t\t},0);\r\n\t\t\t}else{\r\n\t\t\t\tfor(var j in queue[key].exec){\r\n\t\t\t\t\tqueue[key].finished=true;\r\n\t\t\t\t\t(function(){\r\n\t\t\t\t\t\tvar con=j,i=0;\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\tqueue[key].exec[con]();\r\n\t\t\t\t\t\t\tif(i===j) delete queue[key];\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t},0);\r\n\t\t\t\t\t})();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction checkOut(path){\r\n\t\t\tvar i,waitFor,id;\r\n\t\t\tid=IdManager.getId(path);\r\n\t\t\tif(id===undefined){\r\n\t\t\t\tthrow new Error('the path is not included');\r\n\t\t\t}\r\n\t\t\tfor(i in __fnQueue){\r\n\t\t\t\tif(__fnQueue[i].finished) continue;\r\n\t\t\t\twaitFor=__fnQueue[i].waitfor;\r\n\t\t\t\tindex=waitFor.indexOf(id);\r\n\t\t\t\tif(index===undefined)  continue;\r\n\t\t\t\twaitFor.splice(index,1);\r\n\t\t\t\tif(waitFor.length===0){\r\n\t\t\t\t\tasyncExec(__fnQueue,i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tset:set,\r\n\t\t\tget:get,\r\n\t\t\tregister:register,\r\n\t\t\tcheckOut:checkOut,\r\n\t\t\thasAdd:hasAdd\r\n\t\t};\r\n\t})();\r\n\tvar rtObj={};\r\n\t//不暴露设置不可遍历\r\n\trtObj.getModule=Modules.get;\r\n\t//入口\r\n\trtObj.setEntry=function(path,callback){\r\n\t\tpath=Path.polyfill(path);\r\n\t\tloadScript(path,'LOADER',callback);\r\n\t};\r\n\trtObj.checkOut=Modules.checkOut;\r\n\t// Obejct.defineProperties(rtObj,{\r\n\t// \tmodule:{\r\n\t// \t\tvalue:module\r\n\t// \t},\r\n\t// \tentry:{\r\n\t// \t\tset:function(){\r\n\r\n\t// \t\t}\r\n\t// \t}\r\n\t// });\r\n\treturn rtObj;\r\n})();\r\n/*\r\nfunction(){\r\n\tmodule=new Module();\r\n\tfunction(exports,require){\r\n\t\t\r\n\t}(module.exports,module.require)\t\r\n}();\r\n\r\n*/"],"sourceRoot":"/source/"}