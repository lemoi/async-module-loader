{"version":3,"sources":["loader.js"],"names":["undefined","Loader","Error","deepCopy","obj","copyObj","o","target","i","copyFunc","func","temp","apply","this","arguments","key","obj_copy","type","fetchTextFromURL","url","callback","error","xhr","status","statusText","XMLHttpRequest","onerror","onreadystatechange","readyState","responseText","open","setRequestHeader","send","loadScript","path","parent","build","_module","Module","script_text","check","script","Script","children","deP","length","checkReferenceCircle","Modules","register","init","setTimeout","exports","hasAdd","_m","parentPath","parentPaths","get","push","getDep","wrapStart","execPart","wrapEnd","prototype","generate","Head","window","document","head","body","createElement","text","appendChild","removeChild","regExp","result","exec","Path","polyfill","loaded","id","set","require","module","IdManager","setId","__M","getId","hasLoaded","deps","checkFnc","encode","fnObj","idList","waitFor","join","__fnQueue","waitfor","finished","asyncExec","queue","j","checkOut","index","indexOf","splice","path_id_map","_id","rtObj","Object","defineProperties","getModule","value","setEntry","enumerable"],"mappings":"AAWA,GAAYA,SAATC,OAAoB,KAAM,IAAIC,OAAM,iDAEvC,IAAID,QAAO,WACX,GAAIE,GAAS,SAASC,GAEpB,QAASC,GAAQC,EAAEC,GACjB,IAAI,GAAIC,KAAKF,GACM,gBAAPA,GAAEE,IAAsB,OAAPF,EAAEE,IAC3BD,EAAOC,MACPH,EAAQC,EAAEE,GAAGD,EAAOC,KACC,kBAAPF,GAAEE,GAChBD,EAAOC,GAAGC,EAASH,EAAEE,IAErBD,EAAOC,GAAGF,EAAEE,GAIlB,QAASC,GAASC,GAChB,GAAIC,GAAK,WACP,MAAOD,GAAKE,MAAMC,KAAKC,WAEzB,KAAI,GAAIC,KAAOL,GACbC,EAAKI,GAAKZ,EAASO,EAAKK,GAE1B,OAAOJ,GApBT,GAAIK,GAASC,QAAYb,EA8BzB,OARU,aAAPa,EACDD,EAASP,EAASL,GACJ,WAAPa,GAAuB,OAANb,GACxBY,KACAX,EAAQD,EAAIY,IAEZA,EAASZ,EAEJY,GAOLE,EAAiB,SAASC,EAAIC,GAGhC,QAASC,KACP,KAAM,IAAInB,OAAM,aAAeoB,EAAIC,OAAS,KAAOD,EAAIC,QAAUD,EAAIE,WAAa,IAAMF,EAAIE,WAAc,IAAM,IAAM,IAAM,YAAcL,GAH5I,GAAIG,GAAM,GAAIG,eACdH,GAAII,QAAUL,EAIdC,EAAIK,mBAAqB,WACA,IAAnBL,EAAIM,aACa,MAAfN,EAAIC,OACNH,EAASE,EAAIO,cAEbR,MAINC,EAAIQ,KAAK,MAAOX,GAAK,GACjBG,EAAIS,kBACNT,EAAIS,iBAAiB,SAAU,gCAEjCT,EAAIU,QAGFC,EAAW,SAASC,EAAKC,EAAOf,GAgBlC,QAASgB,GAAMF,EAAKC,EAAOf,GACzB,GAAIiB,GAAQ,GAAIC,GAAOJ,EAAKC,EAC5BjB,GAAiBgB,EAAK,SAASK,GAC7B,GAAwCC,GAApCC,EAAO,GAAIC,GAAOH,EAAYL,EAClCG,GAAQM,SAASF,EAAOG,IACxBJ,EAAgC,IAA1BH,EAAQM,SAASE,OAAW,KAAKC,EAAqBZ,GAC5Da,EAAQC,SAASX,EAAQM,SAASH,EAAM,WACtCC,EAAOQ,OACOjD,SAAXoB,GACD8B,WAAW,WACT9B,EAASiB,EAAQc,UACjB,IAGN,KAAI,GAAI3C,KAAK6B,GAAQM,SACfI,EAAQK,OAAOf,EAAQM,SAASnC,KAClC4B,EAAMC,EAAQM,SAASnC,GAAG0B,KA/BlC,GAAImB,GACAP,EAAqB,SAASQ,GAEhC,IADA,GAA6BjB,GAAzBkB,GAAaD,GAAoB9C,EAAE,EACG,QAAnC6B,EAAQU,EAAQS,IAAIF,KACzBC,EAAYE,KAAKpB,EAAQF,QACzB3B,IACA8C,EAAWjB,EAAQF,MAErB,OAAO,UAASD,GACd,IAAI,GAAI1B,GAAE,EAAEA,EAAE+C,EAAYV,OAAO,EAAErC,IACnC,GAAG+C,EAAY/C,KAAK0B,EAAM,OAAO,CAEjC,QAAO,GAwBiB,SAAxBmB,EAAGN,EAAQS,IAAItB,IACjBc,SAASK,EAAGV,SAAS,KAAK,WACV3C,SAAXoB,GACH8B,WAAW,WACT9B,EAASiC,EAAGF,UACZ,KAIJf,EAAMF,EAAKC,EAAOf,IAIlBsB,EAAO,SAASH,EAAYL,GAC9BrB,KAAK+B,IAAIF,EAAOgB,OAAOnB,GACvB1B,KAAK8C,UAAU,4CAA6CzB,EAAK,iCACjErB,KAAK+C,SAASrB,EACd1B,KAAKgD,QAAQ,yEAA0E3B,EAAK,SAE9FQ,GAAOoB,UAAUC,SAAS,WACxB,MAAOlD,MAAK8C,UAAU9C,KAAK+C,SAAS/C,KAAKgD,SAE3CnB,EAAOoB,UAAUb,KAAK,WACpB,GAAIe,GAAKC,OAAOC,SAASC,MAAMF,OAAOC,SAASE,KAC3C3B,EAAOyB,SAASG,cAAc,SAClC5B,GAAO6B,KAAKzD,KAAKkD,WACjBC,EAAKO,YAAY9B,GACjBuB,EAAKQ,YAAY/B,IAEnBC,EAAO+B,OAAO,4BACd/B,EAAOgB,OAAO,SAASnB,GAErB,IADA,GAAImC,GAAO9B,KACsC,QAA1C8B,EAAOhC,EAAO+B,OAAOE,KAAKpC,KAC/BK,EAAIa,KAAKmB,EAAKC,SAASH,EAAO,IAEhC,OAAO9B,GAGT,IAAIgC,GAAK,YACTA,GAAKH,OAAO,0BACZG,EAAKC,SAAS,SAAS3C,GACrB,GAAIwC,GAAOE,EAAKH,OAAOE,KAAKzC,EAC5B,OAAa,QAATwC,EACK,KAAKxC,EAAK,MACElC,SAAZ0E,EAAO,GACP,KAAKxC,EACOlC,SAAZ0E,EAAO,GACP,IAAIxC,EAENA,EAGT,IAAII,GAAO,SAASJ,EAAKC,GACvBtB,KAAKsC,WACLtC,KAAKiE,QAAO,EACZjE,KAAKkE,GAAG7C,EACRrB,KAAKsB,OAAOA,EACZtB,KAAK8B,SAAS,KACdI,EAAQiC,IAAI9C,EAAKrB,MAEnByB,GAAOwB,UAAUmB,QAAQ,SAAS/C,GAChC,MAAO/B,GAAS4C,EAAQS,IAAIoB,EAAKC,SAAS3C,IAAOiB,SAEnD,IAAIJ,GAAQ,WAgBV,QAASK,GAAOlB,GACd,MAAmB,QAAZsB,EAAItB,GAEb,QAAS8C,GAAI9C,EAAKgD,GAChB,GAAIH,GAAGI,EAAUC,MAAMlD,EACvBmD,GAAIN,GAAIG,EAEV,QAAS1B,GAAItB,GACX,GAAI6C,GAAGG,CACP,QAAMH,EAAGI,EAAUG,MAAMpD,MAASgD,EAAOG,EAAIN,IAGpCG,EAFA,KAIX,QAASK,GAAUrD,GACjB,GAAImB,EACJ,WAAWA,EAAGG,EAAItB,MAAQmB,EAAGyB,QAE/B,QAAS9B,GAASwC,EAAKC,EAASrE,GAC9B,GAAIZ,GAAEuE,EAAaW,EAAkBC,EAAMhF,EAAlCiF,KAAiBC,IAC1B,IAAiB,IAAdL,EAAK3C,OAEN,WADAK,YAAW9B,EAAS,EAGtB,KAAIZ,EAAE,EAAEA,EAAEgF,EAAK3C,OAAOrC,IACpBuE,EAAGI,EAAUC,MAAMI,EAAKhF,IACxBoF,EAAOnC,KAAKsB,GACRQ,EAAUC,EAAKhF,MACH,OAAXiF,EACGA,EAASD,EAAKhF,KAChBqF,EAAQpC,KAAKsB,GAEXc,EAAQpC,KAAKsB,GAGvB,OAAoB,KAAjBc,EAAQhD,WACTK,YAAW9B,EAAS,IAGtBsE,EAAOE,EAAOE,KAAK,UACI9F,SAApB+F,EAAUL,GAC0B,kBAA3BK,GAAUL,GAAQf,MAC1BhE,EAAKoF,EAAUL,GAAQf,KACvBoB,EAAUL,GAAQf,QAClBoB,EAAUL,GAAQf,KAAKlB,KAAK9C,EAAKS,IAEjC2E,EAAUL,GAAQf,KAAKlB,KAAKrC,IAG9B2E,EAAUL,MACVC,EAAMI,EAAUL,GAChBC,EAAMhB,KAAKvD,EACXuE,EAAMK,QAAQH,EACdF,EAAMM,UAAS,KAGnB,QAASC,GAAUC,EAAMpF,GACvB,GAAIP,EACJ,IAA6B,kBAAnB2F,GAAMpF,GAAK4D,KACnBwB,EAAMpF,GAAKkF,UAAS,EACpB/C,WAAW,WACXiD,EAAMpF,GAAK4D,aACJwB,GAAMpF,IACX,OAEF,KAAI,GAAIqF,KAAKD,GAAMpF,GAAK4D,KACtBwB,EAAMpF,GAAKkF,UAAS,EACpBzF,EAAE,EACF,WACE0C,WAAW,WACTiD,EAAMpF,GAAK4D,KAAKnE,KACbA,GAAG4F,SAAUD,GAAMpF,GACtBP,KACA,MAKV,QAAS6F,GAASnE,GAChB,GAAI1B,GAAEqF,EAAQd,CAEd,IADAA,EAAGI,EAAUG,MAAMpD,GACXlC,SAAL+E,EACD,KAAM,IAAI7E,OAAM,2BAElB,KAAIM,IAAKuF,GACJA,EAAUvF,GAAGyF,WAChBJ,EAAQE,EAAUvF,GAAGwF,QACrBM,MAAMT,EAAQU,QAAQxB,GACX,KAARuB,QACHT,EAAQW,OAAOF,MAAM,GACD,IAAjBT,EAAQhD,QACTqD,EAAUH,EAAUvF,KA1G1B,GAAI6E,MAAOoB,KAAeV,KACtBZ,EAAU,YA6Gd,OA5GAA,GAAUuB,IAAI,EACdvB,EAAUC,MAAM,SAASlD,GACvB,GAAI6C,GAAG0B,EAAYvE,EACnB,OAAQlC,UAAL+E,GACD0B,EAAYvE,GAAMrB,KAAK6F,IAChB7F,KAAK6F,OAEL3B,GAGXI,EAAUG,MAAM,SAASpD,GACvB,MAAOuE,GAAYvE,KAkGnB8C,IAAIA,EACJxB,IAAIA,EACJR,SAASA,EACTqD,SAASA,EACTjD,OAAOA,MAIPuD,IAgBJ,OAfAC,QAAOC,iBAAiBF,GACtBG,WACEC,MAAMhE,EAAQS,KAEhB6C,UACEU,MAAMhE,EAAQsD,UAEhBW,UACED,MAAM,SAAS7E,EAAKd,GAClBc,EAAK0C,EAAKC,SAAS3C,GACnBD,EAAWC,EAAK,SAASd,IAE3B6F,YAAW,KAGRN","file":"loader.min.js","sourcesContent":["/* \r\n  The loaderjs is just used for browser \r\n\r\n  Version:@0.1.5\r\n*/\r\n\r\n/*\r\nAPI:\r\n  Loader.setEntry('main.js',[function]);加载入口\r\n*/\r\n\r\nif(Loader!==undefined) throw new Error('the loader namespace may be used for other lib');\r\n\r\nvar Loader=(function(){\r\nvar deepCopy=function(obj){\r\n  var obj_copy,type=typeof obj;\r\n  function copyObj(o,target){\r\n    for(var i in o){  \r\n      if(typeof o[i]==='object'&&o[i]!==null){\r\n        target[i]={};\r\n        copyObj(o[i],target[i]);  \r\n      }else if(typeof o[i]==='function'){\r\n        target[i]=copyFunc(o[i]);\r\n      }else{\r\n        target[i]=o[i];\r\n      }\r\n    }\r\n  }\r\n  function copyFunc(func){\r\n    var temp=function(){\r\n      return func.apply(this,arguments);\r\n    };\r\n    for(var key in func){\r\n      temp[key]=deepCopy(func[key]);\r\n    }\r\n    return temp;\r\n  }\r\n  if(type==='function'){\r\n    obj_copy=copyFunc(obj);\r\n  }else if(type==='object'&&obj!==null){\r\n    obj_copy={};\r\n    copyObj(obj,obj_copy);\r\n  }else{\r\n    obj_copy=obj;\r\n  }\r\n  return obj_copy;\r\n};\r\n/*\r\najax加载文件\r\n@param {string} url fetch的地址\r\n@param {function} callback 用来执行加载完成的操作  \r\n*/\r\nvar fetchTextFromURL=function(url,callback){\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.onerror = error;\r\n  function error() {\r\n    throw new Error('XHR error' + (xhr.status ? ' (' + xhr.status + (xhr.statusText ? ' ' + xhr.statusText  : '') + ')' : '') + ' loading ' + url);\r\n  }\r\n  xhr.onreadystatechange = function () {\r\n    if (xhr.readyState === 4) {\r\n      if (xhr.status === 200) {\r\n        callback(xhr.responseText);\r\n      }else {\r\n        error();\r\n      }\r\n    }\r\n  };\r\n  xhr.open(\"GET\", url, true);\r\n  if (xhr.setRequestHeader) {\r\n    xhr.setRequestHeader('Accept', 'application/x-es-module, */*');\r\n  }\r\n  xhr.send();\r\n};\r\n\r\nvar loadScript=function(path,parent,callback){\r\n  var _m;\r\n  var checkReferenceCircle=function(parentPath){\r\n    var parentPaths=[parentPath],_module,i=0;\r\n    while((_module=Modules.get(parentPath))!==null){\r\n      parentPaths.push(_module.parent);\r\n      i++;\r\n      parentPath=_module.parent;\r\n    }   \r\n    return function(path){\r\n      for(var i=0;i<parentPaths.length-1;i++){//length-1 消除Loader\r\n      if(parentPaths[i]===path) return true;\r\n      }\r\n      return false;\r\n    };\r\n  };\r\n  function build(path,parent,callback){\r\n    var _module=new Module(path,parent);\r\n    fetchTextFromURL(path,function(script_text){\r\n      var script=new Script(script_text,path),check;\r\n      _module.children=script.deP;\r\n      check=_module.children.length===0?null:checkReferenceCircle(path);\r\n      Modules.register(_module.children,check,function(){\r\n        script.init();\r\n        if(callback!==undefined){\r\n          setTimeout(function(){\r\n            callback(_module.exports);\r\n          },0);\r\n        }\r\n      });\r\n      for(var i in _module.children){\r\n        if(!Modules.hasAdd(_module.children[i])){\r\n          build(_module.children[i],path);\r\n        }\r\n      }\r\n    });     \r\n  }\r\n  if((_m=Modules.get(path))!==null){\r\n    register(_m.children,null,function(){\r\n      if(callback!==undefined){\r\n      setTimeout(function(){\r\n        callback(_m.exports);\r\n      },0);\r\n      }       \r\n    });\r\n  }else{\r\n    build(path,parent,callback);\r\n  }\r\n};\r\n\r\nvar Script=function(script_text,path){\r\n  this.deP=Script.getDep(script_text);\r\n  this.wrapStart='(function(){var module=Loader.getModule(\\''+path+'\\');(function(require,exports){';\r\n  this.execPart=script_text;\r\n  this.wrapEnd='})(module.require,module.exports);module.loaded=true;Loader.checkOut(\\''+path+'\\')})()';\r\n};\r\nScript.prototype.generate=function(){\r\n  return this.wrapStart+this.execPart+this.wrapEnd;\r\n};\r\nScript.prototype.init=function(){\r\n  var Head=window.document.head||window.document.body;\r\n  var script=document.createElement('script');\r\n  script.text=this.generate();\r\n  Head.appendChild(script);\r\n  Head.removeChild(script);\r\n};\r\nScript.regExp=/require\\(([\"'])(.*?)\\1\\)/g;\r\nScript.getDep=function(script_text){\r\n  var result,deP=[];\r\n  while((result=Script.regExp.exec(script_text))!==null){\r\n    deP.push(Path.polyfill(result[2]));\r\n  }\r\n  return deP;\r\n};\r\n\r\nvar Path=function(){};\r\nPath.regExp=/^(\\.{1,2})?(\\/)?.*?\\.js/;\r\nPath.polyfill=function(path){\r\n  var result=Path.regExp.exec(path);\r\n  if (result===null){\r\n    return './'+path+'.js';\r\n  }else if(result[2]===undefined){\r\n    return \"./\"+path;\r\n  }else if(result[1]===undefined){\r\n    return \".\"+path;\r\n  }\r\n  return path;\r\n};\r\n\r\nvar Module=function(path,parent){\r\n  this.exports={};\r\n  this.loaded=false;\r\n  this.id=path;\r\n  this.parent=parent;//' LOADER'为入口\r\n  this.children=null;\r\n  Modules.set(path,this);\r\n};\r\nModule.prototype.require=function(path){\r\n  return deepCopy(Modules.get(Path.polyfill(path)).exports);\r\n};\r\nvar Modules=(function(){\r\n  var __M=[],path_id_map={},__fnQueue={};\r\n  var IdManager=function(){};\r\n  IdManager._id=1;\r\n  IdManager.setId=function(path){\r\n    var id=path_id_map[path];\r\n    if(id===undefined){\r\n      path_id_map[path]=this._id;\r\n      return this._id++;\r\n    }else{\r\n      return id;\r\n    }\r\n  };\r\n  IdManager.getId=function(path){\r\n    return path_id_map[path];\r\n  };\r\n  function hasAdd(path){\r\n    return get(path)!==null;\r\n  }\r\n  function set(path,module){\r\n    var id=IdManager.setId(path);\r\n    __M[id]=module;\r\n  }\r\n  function get(path){\r\n    var id,module;\r\n    if(!((id=IdManager.getId(path))&&(module=__M[id]))){\r\n      return null;\r\n    }\r\n      return module;\r\n  }\r\n  function hasLoaded(path){\r\n    var _m;\r\n    return !!((_m=get(path))&&_m.loaded);\r\n  }\r\n  function register(deps,checkFnc,callback){\r\n    var i,id,idList=[],encode,waitFor=[],fnObj,temp;\r\n    if(deps.length===0){\r\n      setTimeout(callback,0);\r\n      return;\r\n    }\r\n    for(i=0;i<deps.length;i++){ \r\n      id=IdManager.setId(deps[i]);\r\n      idList.push(id);\r\n      if(!hasLoaded(deps[i])){\r\n        if(checkFnc!==null){\r\n          if(!checkFnc(deps[i])) {\r\n            waitFor.push(id);\r\n          }            \r\n        }else waitFor.push(id); \r\n      }\r\n    }\r\n    if(waitFor.length===0){\r\n      setTimeout(callback,0);\r\n      return;\r\n    }\r\n    encode=idList.join('&');\r\n    if(__fnQueue[encode]!==undefined){\r\n      if(typeof __fnQueue[encode].exec === 'function'){\r\n        temp=__fnQueue[encode].exec;\r\n        __fnQueue[encode].exec=[];\r\n        __fnQueue[encode].exec.push(temp,callback);\r\n      }else{\r\n        __fnQueue[encode].exec.push(callback);\r\n      }\r\n    }else{\r\n      __fnQueue[encode]={};\r\n      fnObj=__fnQueue[encode];\r\n      fnObj.exec=callback;\r\n      fnObj.waitfor=waitFor;\r\n      fnObj.finished=false;\r\n    }\r\n  }\r\n  function asyncExec(queue,key){\r\n    var i;\r\n    if(typeof queue[key].exec ==='function'){\r\n      queue[key].finished=true;\r\n      setTimeout(function(){\r\n      queue[key].exec();\r\n      delete queue[key];\r\n      },0);\r\n    }else{\r\n      for(var j in queue[key].exec){\r\n        queue[key].finished=true;\r\n        i=0;\r\n        (function(){\r\n          setTimeout(function(){\r\n            queue[key].exec[i]();\r\n            if(i==j) delete queue[key];    \r\n            i++;\r\n          },0);\r\n        })();\r\n      }\r\n    }\r\n  }\r\n  function checkOut(path){\r\n    var i,waitFor,id;\r\n    id=IdManager.getId(path);\r\n    if(id===undefined){\r\n      throw new Error('the path is not included');\r\n    }\r\n    for(i in __fnQueue){\r\n      if(__fnQueue[i].finished) continue;\r\n      waitFor=__fnQueue[i].waitfor;\r\n      index=waitFor.indexOf(id);\r\n      if(index===-1)  continue;\r\n      waitFor.splice(index,1);\r\n      if(waitFor.length===0){\r\n        asyncExec(__fnQueue,i);\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    set:set,\r\n    get:get,\r\n    register:register,\r\n    checkOut:checkOut,\r\n    hasAdd:hasAdd\r\n  };\r\n})();\r\n\r\nvar rtObj={};\r\nObject.defineProperties(rtObj,{\r\n  getModule:{\r\n    value:Modules.get\r\n  },\r\n  checkOut:{\r\n    value:Modules.checkOut\r\n  },\r\n  setEntry:{\r\n    value:function(path,callback){\r\n      path=Path.polyfill(path);\r\n      loadScript(path,'LOADER',callback);\r\n    },\r\n    enumerable:true\r\n  }\r\n});\r\nreturn rtObj;\r\n})();"],"sourceRoot":"/source/"}